"use strict";(globalThis.webpackChunkqr_treasurehunt=globalThis.webpackChunkqr_treasurehunt||[]).push([[573],{4744:(e,t,n)=>{n.d(t,{J$:()=>a,N7:()=>c,Pr:()=>i,UD:()=>r,Wp:()=>o,hP:()=>d,wU:()=>s,xP:()=>u,zj:()=>l});const r=e=>{const t=e.export(),n=function(e){let t,n=0,r=e.length,a="";for(;n<r;)t=e.subarray(n,Math.min(n+32768,r)),a+=String.fromCharCode.apply(null,t),n+=32768;return btoa(a)}(new Uint8Array(t));localStorage.setItem("sqlite-db",n),console.log("Database saved to localStorage")};const a=(e,t,n)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout(()=>{t&&(console.log("Retrying image load with available database"),a(e,t,n))},100),null;try{const r=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode = ?");if(r.bind([e.toString()]),r.step()){const t=r.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),n&&n(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),n&&n(null),null}catch(r){return console.error("Error loading image:",r),n&&n("ERROR"),"ERROR"}},s=async(e,t,n,r)=>{try{console.log("Loading database...");const s={locateFile:()=>"/sql/sql-wasm.wasm"};await(a="/sql/sql-wasm.js",new Promise((e,t)=>{if(window.initSqlJs)return void e();const n=document.createElement("script");n.src=a,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)}));const o=await window.initSqlJs(s),i=localStorage.getItem("sqlite-db");let d;if(i){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(i).split("").map(e=>e.charCodeAt(0)));d=new o.Database(e)}else console.log("No saved database found, creating new one"),d=new o.Database,d.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);");e(d),((e,t,n,r)=>{try{console.log("Initializing treasure sequence...");const a=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),s=[];for(;a.step();){const e=a.getAsObject();s.push(e.qrkode)}a.free(),console.log("Found treasure sequence:",s),t(s),s.length>0?(console.log("Loading first image for step 1"),r(1,e)):(console.log("No treasures found in database"),n("NO_DATA"))}catch(a){console.error("Error initializing sequence:",a),n("ERROR")}})(d,n,t,r)}catch(s){console.error("Error loading database:",s),t("ERROR")}var a},o=(e,t,n)=>{const r=e.exec("SELECT * FROM steg"),a=r[0]?r[0].values:[];if(t(a),0===a.length)n(1);else{const e=a.map(([e])=>parseInt(e)).filter(e=>!isNaN(e));n(e.length>0?Math.max(...e)+1:1)}},i=(e,t,n)=>"random"===e?t:n,d=(e,t,n,r,s,o,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:h,setGameComplete:g,setCurrentImage:b}=l,p=i(n,r,s),m=p.slice(0,-1),f=m.includes(e),x=o.includes(e);if(f&&!x){u(t=>[...t,e]);const t=m.filter(t=>!o.includes(t)&&t!==e);if(0===t.length){const t=s[s.length-1];a(t,d,b),h(p.length),g(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`)}else{const n=t[0];a(n,d,b),h(o.length+1),1===t.length?c(`${e} found! Find the last location (QR ${n})`):c(`${e} found! Find any of the ${t.length} remaining locations`)}}else x?c(`Already found: QR ${e} was already scanned`):s.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")},l=(e,t,n,r)=>{const{setGameStarted:s,setCurrentStep:o,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=r;if(0!==t.length)if(s(!0),o(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t})(t.slice(0,-1));c([...e,t[t.length-1]]),a(e[0],n,u)}else c(t),a(t[0],n,u)},c=(e,t,n,a,s)=>{try{const i=e.prepare("DELETE FROM steg WHERE qrkode = ?");i.bind([t]),i.step(),i.free(),r(e),o(e,a,s),n(`Item with QR code ${t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),n("Error deleting item from database.")}},u=(e,t,n,a,s,i,d)=>{try{if(t===n||t<0||n<0||t>=a.length||n>=a.length)return;const l=[...a],[c]=l.splice(t,1);l.splice(n,0,c),e.run("DELETE FROM steg"),l.forEach(([t,n])=>{const r=e.prepare("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)");r.bind([t,n]),r.step(),r.free()}),r(e),o(e,i,d);const u=t<n?"down":"up";s(`Moved item with QR code ${c[0]} ${u} to position ${n+1}`)}catch(l){console.error("Error reordering database items:",l),s("Error reordering items in database.")}}},5292:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>S,contentTitle:()=>x,default:()=>y,frontMatter:()=>f,metadata:()=>r,toc:()=>w});const r=JSON.parse('{"id":"treasurehunter/create-treasure-hunt","title":"Create Treasure Hunt","description":"","source":"@site/docs/treasurehunter/create-treasure-hunt.mdx","sourceDirName":"treasurehunter","slug":"/treasurehunter/create-treasure-hunt","permalink":"/docs/treasurehunter/create-treasure-hunt","draft":false,"unlisted":false,"editUrl":"https://github.com/qr-treasurehunt/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/treasurehunter/create-treasure-hunt.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Create Treasure Hunt","hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"Instructions","permalink":"/docs/treasurehunter/instructions"},"next":{"title":"Perform Treasure Hunt","permalink":"/docs/treasurehunter/treasure-hunt"}}');var a=n(4848),s=n(8453),o=n(6540),i=n(6624),d=n.n(i);const l=(0,o.forwardRef)(({onQRCodeScanned:e,width:t=320,height:n=240,style:r={}},s)=>{const i=(0,o.useRef)(null),l=(0,o.useRef)(null);return(0,o.useImperativeHandle)(s,()=>({takeSnapshot:()=>{if(i.current&&l.current){return l.current.getContext("2d").drawImage(i.current,0,0,l.current.width,l.current.height),l.current.toDataURL("image/jpeg",.8)}return null}})),(0,o.useEffect)(()=>{let t,n=null,r=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!r)return void a.getTracks().forEach(e=>e.stop());if(n=a,i.current){i.current.srcObject=a,i.current.setAttribute("playsinline",!0),i.current.setAttribute("muted",!0);const n=async()=>{try{if(await i.current.play(),r&&i.current&&!i.current.paused){const n=()=>{if(r&&i.current&&!i.current.paused){if(i.current&&l.current){const t=l.current.getContext("2d");t.drawImage(i.current,0,0,l.current.width,l.current.height);const n=t.getImageData(0,0,l.current.width,l.current.height),r=d()(n.data,n.width,n.height);r&&r.data&&e&&e(r.data)}r&&(t=setTimeout(()=>{r&&i.current&&!i.current.paused&&n()},200))}};n()}}catch(n){"AbortError"!==n.name&&console.warn("Video play error:",n)}};i.current.readyState>=1?n():i.current.addEventListener("loadedmetadata",n,{once:!0})}}catch(a){console.error("Error accessing camera:",a)}})(),()=>{if(r=!1,t&&clearTimeout(t),i.current&&(i.current.pause(),i.current.srcObject)){i.current.srcObject.getTracks().forEach(e=>e.stop()),i.current.srcObject=null}n&&n.getTracks().forEach(e=>e.stop())}},[e]),(0,a.jsxs)("div",{style:r,children:[(0,a.jsx)("video",{ref:i,style:{width:t,height:n,...r.video}}),(0,a.jsx)("canvas",{ref:l,width:t,height:n,style:{display:"none"}})]})});l.displayName="QRScannerWithSnapshot";const c=l,u=({showScanner:e,setShowScanner:t,qrCode:n,setQrCode:r,setSnapshot:s,setImage:i,setMessage:d})=>{const l=(0,o.useRef)(null);(0,o.useEffect)(()=>{t(!0)},[t]);return(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:500,marginBottom:6},children:"QR-code scanner:"}),e&&(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{ref:l,onQRCodeScanned:e=>{r(e),d(`QR code scanned: ${e}`)},width:320,height:240}),(0,a.jsxs)("div",{style:{marginTop:10},children:[(0,a.jsx)("button",{onClick:()=>{if(l.current){const e=l.current.takeSnapshot();e&&(s(e),i(e),d("Snapshot taken! You can now save the QR code and image."))}},style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",marginRight:8,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.08)",transition:"background 0.2s"},children:"Take Snapshot"}),(0,a.jsx)("button",{onClick:()=>t(!1),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#757575",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(117, 117, 117, 0.08)",transition:"background 0.2s"},children:"Stop Scanner"})]})]}),!e&&(0,a.jsx)("button",{onClick:()=>t(!0),style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#1976d2",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:"pointer",marginRight:12,boxShadow:"0 1px 4px rgba(25, 118, 210, 0.08)",transition:"background 0.2s"},children:"Start QR Scanner"}),n&&(0,a.jsxs)("div",{style:{marginTop:10,padding:10,background:"#f5f5f5",borderRadius:6},children:[(0,a.jsx)("strong",{children:"Scanned QR Code:"})," ",n]})]})},h=({snapshot:e,setSnapshot:t,image:n,setImage:r,qrCode:s,nextQRNumber:o,handleSave:i,handleSaveFinalTreasure:d})=>(0,a.jsxs)(a.Fragment,{children:[e&&(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("div",{style:{padding:10,background:"#e8f5e8",borderRadius:6,marginBottom:10},children:(0,a.jsx)("strong",{children:"\u2713 Snapshot taken from camera"})}),(0,a.jsx)("button",{onClick:()=>{t(null),r(null)},style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#ff9800",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(255, 152, 0, 0.08)",transition:"background 0.2s"},children:"Clear Snapshot"})]}),n&&(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("h3",{style:{marginBottom:8},children:"Preview of snapshot:"}),(0,a.jsx)("img",{src:n,alt:"Preview",width:"200",style:{borderRadius:8,boxShadow:"0 1px 6px rgba(0,0,0,0.08)"}})]}),(0,a.jsxs)("div",{style:{marginBottom:24},children:[(0,a.jsxs)("div",{style:{marginBottom:16},children:[(0,a.jsx)("h4",{style:{marginBottom:10},children:"Save Options:"}),(0,a.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:15},children:"Choose how to save this location:"})]}),(0,a.jsxs)("button",{onClick:i,disabled:!s||!n,style:{padding:"10px 20px",borderRadius:6,border:"none",background:s&&n?"#1976d2":"#ccc",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:s&&n?"pointer":"not-allowed",marginRight:12,marginBottom:8,boxShadow:"0 1px 4px rgba(25, 118, 210, 0.08)",transition:"background 0.2s"},title:s?n?"Save as regular hunt location":"Take a snapshot first":"Scan a QR code first",children:["Save as Hunt Location ",s?`(QR: ${s})`:""]}),(0,a.jsx)("br",{}),(0,a.jsxs)("button",{onClick:d,disabled:!n,style:{padding:"10px 20px",borderRadius:6,border:"none",background:n?"#ff9800":"#ccc",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:n?"pointer":"not-allowed",boxShadow:"0 1px 4px rgba(255, 152, 0, 0.08)",transition:"background 0.2s"},title:n?"Save as final treasure location (no QR code needed)":"Take a snapshot first",children:["Save as Final Treasure (#",o,")"]}),(0,a.jsxs)("div",{style:{marginTop:10,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["\ud83d\udca1 ",(0,a.jsx)("strong",{children:"Tip:"})," Save hunt locations first (with QR codes), then save the final treasure location last (no QR code)."]})]})]});var g=n(4744);const b=({databaseContent:e,db:t,setDb:n,setMessage:r,setDatabaseContent:s,setQrCode:o,setImage:i,setSnapshot:d,setShowScanner:l,setNextQRNumber:c})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{children:"Image database:"}),(0,a.jsxs)("table",{children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Actions"}),(0,a.jsx)("th",{children:"QR-code"}),(0,a.jsx)("th",{children:"Image (Base64)"}),(0,a.jsx)("th",{children:"Order"})]})}),(0,a.jsx)("tbody",{children:0===e.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"4",children:"The database is empty"})}):e.map(([n,o],i)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{style:{textAlign:"center"},children:(0,a.jsx)("button",{onClick:()=>(e=>{t?window.confirm(`Are you sure you want to delete the item with QR code ${e}?`)&&(0,g.N7)(t,e,r,s,c):r("Database not available")})(n),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#e74c3c",color:"#fff",fontWeight:600,fontSize:"0.875rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(231, 76, 60, 0.08)",transition:"background 0.2s"},children:"Delete"})}),(0,a.jsx)("td",{children:n}),(0,a.jsx)("td",{children:(0,a.jsx)("img",{src:o,alt:`Bilde ${n}`,width:"50"})}),(0,a.jsx)("td",{style:{textAlign:"center",padding:"8px"},children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[(0,a.jsx)("button",{onClick:()=>(n=>{n>0&&(0,g.xP)(t,n,n-1,e,r,s,c)})(i),disabled:0===i,style:{padding:"4px 8px",borderRadius:4,border:"none",background:0===i?"#bdc3c7":"#3498db",color:"#fff",fontWeight:600,fontSize:"0.75rem",cursor:0===i?"not-allowed":"pointer",minWidth:"28px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(52, 152, 219, 0.08)",transition:"background 0.2s"},children:"\u2191"}),(0,a.jsx)("button",{onClick:()=>(n=>{n<e.length-1&&(0,g.xP)(t,n,n+1,e,r,s,c)})(i),disabled:i===e.length-1,style:{padding:"4px 8px",borderRadius:4,border:"none",background:i===e.length-1?"#bdc3c7":"#2ecc71",color:"#fff",fontWeight:600,fontSize:"0.75rem",cursor:i===e.length-1?"not-allowed":"pointer",minWidth:"28px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(46, 204, 113, 0.08)",transition:"background 0.2s"},children:"\u2193"})]})})]},i))})]}),(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)("button",{onClick:async()=>{localStorage.removeItem("sqlite-db"),r("Databasen er t\xf8mt.");var e;await(e="/sql/sql-wasm.js",new Promise((t,n)=>{if(window.initSqlJs)return void t();const r=document.createElement("script");r.src=e,r.async=!0,r.onload=t,r.onerror=n,document.body.appendChild(r)}));const t=new((await window.initSqlJs({locateFile:()=>"/sql/sql-wasm.wasm"})).Database);t.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);"),n(t),s([]),o(""),i(null),d(null),l(!1),c(1)},style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#e74c3c",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(231, 76, 60, 0.08)",transition:"background 0.2s"},children:"Clear database"})})]}),p=({message:e,showScanner:t,setShowScanner:n,qrCode:r,setQrCode:s,setSnapshot:o,setImage:i,setMessage:d,snapshot:l,image:c,nextQRNumber:g,handleSave:p,handleSaveFinalTreasure:m,databaseContent:f,db:x,setDb:S,setDatabaseContent:w,setShowScanner:R,setNextQRNumber:y})=>(0,a.jsxs)("div",{style:{maxWidth:500,padding:24,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,a.jsx)("p",{children:e}),(0,a.jsx)(u,{showScanner:t,setShowScanner:n,qrCode:r,setQrCode:s,setSnapshot:o,setImage:i,setMessage:d}),(0,a.jsx)(h,{snapshot:l,setSnapshot:o,image:c,setImage:i,qrCode:r,nextQRNumber:g,handleSave:p,handleSaveFinalTreasure:m}),(0,a.jsx)(b,{databaseContent:f,db:x,setDb:S,setMessage:d,setDatabaseContent:w,setQrCode:s,setImage:i,setSnapshot:o,setShowScanner:R,setNextQRNumber:y})]});const m=()=>{const[e,t]=(0,o.useState)(null),[n,r]=(0,o.useState)("Vent, laster inn..."),[s,i]=(0,o.useState)(""),[d,l]=(0,o.useState)(null),[c,u]=(0,o.useState)([]),[h,b]=(0,o.useState)(!1),[m,f]=(0,o.useState)(null),[x,S]=(0,o.useState)(1),w=async()=>{const e={locateFile:()=>"/sql/sql-wasm.wasm"};try{await(n="/sql/sql-wasm.js",new Promise((e,t)=>{if(window.initSqlJs)return void e();const r=document.createElement("script");r.src=n,r.async=!0,r.onload=e,r.onerror=t,document.body.appendChild(r)}));const a=await window.initSqlJs(e);let s;console.log("sql.js initialized \ud83c\udf89");const o=localStorage.getItem("sqlite-db");if(o){const e=new Uint8Array(atob(o).split("").map(e=>e.charCodeAt(0)));s=new a.Database(e),console.log("Database loaded from localStorage")}else s=new a.Database,s.run("\n          CREATE TABLE IF NOT EXISTS steg (\n            qrkode TEXT PRIMARY KEY,\n            bilde_base64 TEXT\n          );\n        ");t(s),r("Start scanning QR codes and taking snapshots!"),(0,g.Wp)(s,u,S)}catch(a){console.error("Error initializing sql.js:",a),r("Could not load the database.")}var n};return(0,o.useEffect)(()=>{w()},[]),(0,a.jsx)(p,{message:n,showScanner:h,setShowScanner:b,qrCode:s,setQrCode:i,setSnapshot:f,setImage:l,setMessage:r,snapshot:m,image:d,nextQRNumber:x,handleSave:()=>{if(!s||!d||!e)return void r("Please scan a QR code and take a snapshot first!");const t=e.prepare("SELECT COUNT(*) as count FROM steg WHERE qrkode = ?");t.bind([s]);let n=!1;if(t.step()){n=t.getAsObject().count>0}t.free(),n?(e.run("UPDATE steg SET bilde_base64 = ? WHERE qrkode = ?",[d,s]),r(`QR-kode ${s} oppdatert med nytt bilde!`)):(e.run("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)",[s,d]),r(`QR-kode ${s} og bilde lagret!`)),(0,g.UD)(e),(0,g.Wp)(e,u,S),i(""),l(null),f(null)},handleSaveFinalTreasure:()=>{if(!d||!e)return void r("Please take a snapshot of the treasure location first!");const t=(()=>{if(0===c.length)return 1;const e=c.map(([e])=>parseInt(e)).filter(e=>!isNaN(e));return e.length>0?Math.max(...e)+1:1})();try{e.run("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)",[t.toString(),d]),r(`Final treasure location saved as entry ${t}! This is where the treasure is hidden (no QR code needed).`),(0,g.UD)(e),(0,g.Wp)(e,u,S),f(null),l(null)}catch(n){console.error("Error saving final treasure:",n),r("Error saving final treasure location.")}},databaseContent:c,db:e,setDb:t,setDatabaseContent:u,setNextQRNumber:S})},f={sidebar_position:2,title:"Create Treasure Hunt",hide_title:!0},x=void 0,S={},w=[];function R(e){return(0,a.jsx)(m,{})}function y(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(R,{...e})}):R()}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var r=n(6540);const a={},s=r.createContext(a);function o(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);