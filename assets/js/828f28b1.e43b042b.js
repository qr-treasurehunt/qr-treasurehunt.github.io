"use strict";(globalThis.webpackChunkqr_treasurehunt=globalThis.webpackChunkqr_treasurehunt||[]).push([[282],{3914:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(6540),o=n(4848);const s=({huntMode:e,setHuntMode:t,onStartGame:n,treasureCount:r,treasureSequence:s})=>{const a=s&&s.some(e=>null===e),i=s?s.filter(e=>null!==e):[],d=a&&i.length>0;return(0,o.jsxs)("div",{style:{marginBottom:20,padding:20,background:"#f8f9fa",borderRadius:8},children:[(0,o.jsx)("h3",{style:{textAlign:"center",marginBottom:15},children:"Choose Hunt Mode"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[(0,o.jsxs)("div",{style:{padding:15,border:"sequential"===e?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"sequential"===e?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>t("sequential"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"sequential"===e?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Sequential Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Follow the hunt in order (1, 2, 3...). Perfect for guided tours or specific paths."})]}),(0,o.jsxs)("div",{style:{padding:15,border:"random"===e?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"random"===e?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>t("random"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"random"===e?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Random Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Find locations in any order. Great for exploration and flexibility."})]})]}),(0,o.jsx)("div",{style:{textAlign:"center",marginTop:20},children:(0,o.jsxs)("button",{onClick:n,disabled:!d,style:{padding:"12px 24px",borderRadius:8,border:"none",background:d?"#007bff":"#ccc",color:"#fff",fontWeight:600,cursor:d?"pointer":"not-allowed",fontSize:"1em",boxShadow:d?"0 2px 8px rgba(0, 123, 255, 0.3)":"none",transition:"all 0.2s"},onMouseOver:e=>d&&(e.target.style.background="#0056b3"),onMouseOut:e=>d&&(e.target.style.background="#007bff"),title:d?"":"Add a final treasure location to start the hunt",children:["Start ","sequential"===e?"Sequential":"Random"," Hunt \ud83d\uddfa\ufe0f"]})}),!a&&(0,o.jsx)("div",{style:{textAlign:"center",marginTop:15,padding:10,background:"#fff3cd",color:"#856404",borderRadius:6,fontSize:"0.9em"},children:"\u26a0\ufe0f No final treasure location found. Please add a final treasure to start the hunt."}),0===i.length&&a&&(0,o.jsx)("div",{style:{textAlign:"center",marginTop:15,padding:10,background:"#fff3cd",color:"#856404",borderRadius:6,fontSize:"0.9em"},children:"\u26a0\ufe0f No hunt locations found. Please add at least one hunt location with a QR code."}),(0,o.jsxs)("div",{style:{textAlign:"center",marginTop:15,fontSize:"0.8em",color:"#666"},children:["Found ",r," location",1!==r?"s":""," in database",r>0&&(0,o.jsxs)("span",{children:[" \u2022 ",i.length," QR code",1!==i.length?"s":""," + ",a?"1":"0"," treasure location"]})]})]})},a=({gameStarted:e,gameComplete:t,scannedCodes:n,treasureSequence:r,huntMode:s,getCurrentSequence:a})=>e?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:10},children:t?`Treasure Hunt Complete! Found ${n.length} locations + treasure`:`Progress: ${n.length} of ${r.length-1} locations found`}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:5},children:a().map((e,r)=>(0,o.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:r<n.length?"#4caf50":r!==n.length||t?r===a().length-1&&t?"#ffd700":"#e0e0e0":"#2196f3"},title:r===a().length-1?"Treasure location":`Location ${r+1}`},r))}),t&&(0,o.jsx)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:"\ud83c\udfc6 = Treasure location (no QR code here)"}),(0,o.jsxs)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:["Mode: ","sequential"===s?"Sequential":"Random"," Hunt"]})]}):null,i=({currentImage:e,currentStep:t,gameComplete:n,scannedCodes:r,onStartNewHunt:s})=>"NO_DATA"===e?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#fff3cd",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"No Treasure Hunt Data Found"}),(0,o.jsx)("p",{children:"Please use the Treasure Hunt Maker to create some QR codes and images first."}),(0,o.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:"Go to the maker page, scan QR codes, take snapshots, and save them to the database."})]}):"ERROR"===e?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#f8d7da",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"Error Loading Treasure Hunt"}),(0,o.jsx)("p",{children:"There was an error loading the treasure hunt data."}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#dc3545",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:10},children:"Retry"})]}):e&&0!==e.length?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("h3",{style:{marginBottom:10},children:n?"\ud83c\udf89 Treasure Found! \ud83c\udf89":0===r.length?"Find this location to start!":`Find location ${t}`}),(0,o.jsx)("img",{src:e,alt:`Location ${t}`,style:{maxWidth:"100%",borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),(0,o.jsx)("div",{style:{marginTop:10,fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:n?"\ud83c\udfc6 This is where the treasure is hidden! No QR code to scan here.":"When you find this location, scan the QR code there to proceed."}),n&&(0,o.jsx)("button",{onClick:s,style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:15,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.3)"},children:"Start New Hunt"})]}):(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:"#e3f2fd",borderRadius:8,textAlign:"center"},children:(0,o.jsx)("strong",{children:"Loading treasure hunt..."})});var d=n(6624),l=n.n(d);const c=({onQRCodeScanned:e,width:t=320,height:n=240,style:s={}})=>{const a=(0,r.useRef)(null),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let t,n=null,r=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!r)return void o.getTracks().forEach(e=>e.stop());if(n=o,a.current){a.current.srcObject=o,a.current.setAttribute("playsinline",!0),a.current.setAttribute("muted",!0);const n=async()=>{try{if(await a.current.play(),r&&a.current&&!a.current.paused){const n=()=>{if(r&&a.current&&!a.current.paused){if(a.current&&i.current){const t=i.current.getContext("2d");t.drawImage(a.current,0,0,i.current.width,i.current.height);const n=t.getImageData(0,0,i.current.width,i.current.height),r=l()(n.data,n.width,n.height);r&&r.data&&e(r.data)}r&&(t=setTimeout(()=>{r&&a.current&&!a.current.paused&&n()},200))}};n()}}catch(n){"AbortError"!==n.name&&console.warn("Video play error:",n)}};a.current.readyState>=1?n():a.current.addEventListener("loadedmetadata",n,{once:!0})}}catch(o){console.error("Error accessing camera:",o)}})(),()=>{if(r=!1,t&&clearTimeout(t),a.current&&(a.current.pause(),a.current.srcObject)){a.current.srcObject.getTracks().forEach(e=>e.stop()),a.current.srcObject=null}n&&n.getTracks().forEach(e=>e.stop())}},[e]),(0,o.jsxs)("div",{style:s,children:[(0,o.jsx)("video",{ref:a,style:{width:t,height:n,...s.video}}),(0,o.jsx)("canvas",{ref:i,width:t,height:n,style:{display:"none"}})]})},u=({gameComplete:e,lastScannedCode:t,handleQRCodeScanned:n,scannedCodes:r,currentStep:s,showScannedCode:a,onDismissMessage:i})=>{if(e)return null;const d=t&&(t.includes("Wrong sequence")||t.includes("Already used")||t.includes("Already found")||t.includes("Already scanned")||t.includes("Not part of this hunt")||t.includes("This QR code is part of the treasure hunt but not a location to find"));return(0,o.jsxs)(o.Fragment,{children:[t&&(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:d?"#ffebee":"#e8f5e8",borderRadius:8,border:d?"1px solid #f44336":"1px solid #4caf50",position:"relative"},children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[(0,o.jsxs)("span",{style:{color:d?"#d32f2f":"#2e7d32",fontWeight:500,flex:1},children:[d?"\u26a0\ufe0f":"\u2705"," ",t.replace(/^Wrong sequence: |^Already used: |^Already scanned: |^Not part of this hunt: /,"")]}),i&&(0,o.jsx)("button",{onClick:i,style:{background:"none",border:"none",color:d?"#d32f2f":"#2e7d32",fontSize:"18px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"30px",height:"30px"},title:"Dismiss message",children:"\u2715"})]})}),(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("h4",{style:{marginBottom:10},children:"QR Code Scanner"}),(0,o.jsx)(c,{onQRCodeScanned:n,width:320,height:240}),a&&t&&!d&&(0,o.jsxs)("div",{style:{marginTop:5,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["Last scanned: ",t]})]})]})};var g=n(4744);const h=({showScannedCode:e=!1})=>{const[t,n]=(0,r.useState)(null),[d,l]=(0,r.useState)(1),[c,h]=(0,r.useState)(null),[f,p]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[b,S]=(0,r.useState)(!1),[E,y]=(0,r.useState)(""),[R,C]=(0,r.useState)("sequential"),[j,v]=(0,r.useState)(!1),[T,w]=(0,r.useState)([]),[A,k]=(0,r.useState)(null);(0,r.useEffect)(()=>{(0,g.wU)(n,h,x,(e,t)=>{(0,g.J$)(e,t,h)})},[]);return(0,o.jsxs)("div",{style:{maxWidth:500,margin:"0px auto",padding:20,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,o.jsx)("h2",{style:{textAlign:"center",marginBottom:20},children:"Treasure Hunt"}),!j&&m.length>0&&"NO_DATA"!==c&&"ERROR"!==c&&(0,o.jsx)(s,{huntMode:R,setHuntMode:C,onStartGame:()=>{if(!m.some(e=>null===e))return void alert("Cannot start hunt: No final treasure location found! Please add a final treasure location first.");if(0===m.filter(e=>null!==e).length)return void alert("Cannot start hunt: No hunt locations found! Please add at least one hunt location with a QR code.");k(null);const e={setGameStarted:v,setCurrentStep:l,setScannedCodes:p,setLastScannedCode:y,setGameComplete:S,setShuffledSequence:w,setCurrentImage:h};(0,g.zj)(R,m,t,e)},treasureCount:m.length,treasureSequence:m}),(0,o.jsx)(a,{gameStarted:j,gameComplete:b,scannedCodes:f,treasureSequence:m,huntMode:R,getCurrentSequence:()=>(0,g.Pr)(R,T,m)}),j&&(0,o.jsx)(i,{currentImage:c,currentStep:d,gameComplete:b,scannedCodes:f,onStartNewHunt:()=>{window.location.reload()}}),j&&(0,o.jsx)(u,{gameComplete:b,lastScannedCode:E,handleQRCodeScanned:e=>{if(e===A)return;k(e);const n={setLastScannedCode:y,setScannedCodes:p,setCurrentStep:l,setGameComplete:S,setCurrentImage:h};(0,g.hP)(e,d,R,T,m,f,t,n)},scannedCodes:f,currentStep:d,showScannedCode:e,onDismissMessage:()=>{y("")}})]})}},4744:(e,t,n)=>{n.d(t,{J$:()=>o,N7:()=>c,Pr:()=>i,UD:()=>r,Wp:()=>a,hP:()=>d,wU:()=>s,xP:()=>u,zj:()=>l});const r=e=>{const t=e.export(),n=function(e){let t,n=0,r=e.length,o="";for(;n<r;)t=e.subarray(n,Math.min(n+32768,r)),o+=String.fromCharCode.apply(null,t),n+=32768;return btoa(o)}(new Uint8Array(t));localStorage.setItem("sqlite-db",n),console.log("Database saved to localStorage")};const o=(e,t,n)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout(()=>{t&&(console.log("Retrying image load with available database"),o(e,t,n))},100),null;try{const r=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode IS ?");if(r.bind([null===e?null:e.toString()]),r.step()){const t=r.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),n&&n(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),n&&n(null),null}catch(r){return console.error("Error loading image:",r),n&&n("ERROR"),"ERROR"}},s=async(e,t,n,o)=>{try{console.log("Loading database...");const a={locateFile:()=>"/sql/sql-wasm.wasm"};await(s="/sql/sql-wasm.js",new Promise((e,t)=>{if(window.initSqlJs)return void e();const n=document.createElement("script");n.src=s,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)}));const i=await window.initSqlJs(a),d=localStorage.getItem("sqlite-db");let l;if(d){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(d).split("").map(e=>e.charCodeAt(0)));l=new i.Database(e)}else console.log("No saved database found, creating new one"),l=new i.Database,l.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT, order_index INTEGER);");e(l),((e,t,n,o)=>{try{console.log("Initializing treasure sequence...");try{e.run("ALTER TABLE steg ADD COLUMN order_index INTEGER"),console.log("Added order_index column to existing table")}catch(s){console.log("order_index column handling:",s.message)}const a=e.prepare("SELECT COUNT(*) as count FROM steg WHERE order_index IS NULL");a.step();const i=a.getAsObject().count;if(a.free(),i>0){console.log("Initializing order_index for existing records");const t=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),n=[];for(;t.step();)n.push(t.getAsObject().qrkode);t.free(),n.forEach((t,n)=>{const r=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode = ?");r.bind([n,t]),r.step(),r.free()}),r(e)}const d=e.prepare("SELECT qrkode FROM steg ORDER BY COALESCE(order_index, 999999), CASE WHEN qrkode IS NULL THEN 1 ELSE 0 END"),l=[];for(;d.step();){const e=d.getAsObject();l.push(e.qrkode)}if(d.free(),console.log("Found treasure sequence:",l),t(l),l.length>0){const t=l.find(e=>null!==e);t?(console.log("Loading first image for QR code:",t),o(t,e)):(console.log("No QR codes found, only final treasure"),n("NO_DATA"))}else console.log("No treasures found in database"),n("NO_DATA")}catch(s){console.error("Error initializing sequence:",s),n("ERROR")}})(l,n,t,o)}catch(a){console.error("Error loading database:",a),t("ERROR")}var s},a=(e,t,n)=>{const r=e.exec("SELECT * FROM steg ORDER BY COALESCE(order_index, 999999), CASE WHEN qrkode IS NULL THEN 1 ELSE 0 END"),o=r[0]?r[0].values:[];if(t(o),0===o.length)n(1);else{const e=o.map(([e])=>parseInt(e)).filter(e=>!isNaN(e));n(e.length>0?Math.max(...e)+1:1)}},i=(e,t,n)=>"random"===e?t:n,d=(e,t,n,r,s,a,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:g,setGameComplete:h,setCurrentImage:f}=l,p=i(n,r,s),m=p.filter(e=>null!==e),x=m.includes(e),b=a.includes(e);if("sequential"===n){const a=((e,t,n,r)=>{const o=i(e,t,n);return 0===o.length||r>o.length?null:o[r-1]})(n,r,s,t);if(e===a)if(u(t=>[...t,e]),t===m.length)o(null,d,f),g(p.length),h(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`);else{const n=t+1,r=m[n-1];o(r,d,f),g(n),c(`${e} found! Now find location ${n} (QR ${r})`)}else b?c(`Already found: QR ${e} was already scanned`):x?c(`Out of sequence: You scanned QR ${e}, but please find QR ${a} first (step ${t})`):s.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")}else if(x&&!b){u(t=>[...t,e]);const t=m.filter(t=>!a.includes(t)&&t!==e);if(0===t.length)o(null,d,f),g(p.length),h(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`);else{const n=t[0];o(n,d,f),g(a.length+1),1===t.length?c(`${e} found! Find the last location (QR ${n})`):c(`${e} found! Find any of the ${t.length} remaining locations`)}}else b?c(`Already found: QR ${e} was already scanned`):s.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")},l=(e,t,n,r)=>{const{setGameStarted:s,setCurrentStep:a,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=r;if(0!==t.length)if(s(!0),a(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t})(t.filter(e=>null!==e));c([...e,null]),o(e[0],n,u)}else{c(t);const e=t.find(e=>null!==e);e&&o(e,n,u)}},c=(e,t,n,o,s)=>{try{if(null===t){const t=e.prepare("DELETE FROM steg WHERE qrkode IS NULL");t.step(),t.free()}else{const n=e.prepare("DELETE FROM steg WHERE qrkode = ?");n.bind([t]),n.step(),n.free()}const i=e.exec("SELECT qrkode FROM steg ORDER BY COALESCE(order_index, 999999), CASE WHEN qrkode IS NULL THEN 1 ELSE 0 END");i[0]&&i[0].values&&i[0].values.forEach(([t],n)=>{if(null===t){const t=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode IS NULL");t.bind([n]),t.step(),t.free()}else{const r=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode = ?");r.bind([n,t]),r.step(),r.free()}}),r(e),a(e,o,s),n(`Item with QR code ${null===t?"(Final Treasure)":t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),n("Error deleting item from database.")}},u=(e,t,n,o,s,i,d)=>{try{if(t===n||t<0||n<0||t>=o.length||n>=o.length)return;const l=o[t][0],c=o[n][0];if(null===l||null===c)return void s("Cannot reorder the final treasure location. It must remain last.");const u=[...o],[g]=u.splice(t,1);u.splice(n,0,g),u.forEach(([t],n)=>{if(null===t){const t=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode IS NULL");t.bind([n]),t.step(),t.free()}else{const r=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode = ?");r.bind([n,t]),r.step(),r.free()}}),r(e),a(e,i,d);const h=t<n?"down":"up";s(`Moved item with QR code ${g[0]} ${h} to position ${n+1}`)}catch(l){console.error("Error reordering database items:",l),s("Error reordering items in database.")}}},9316:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});n(6540);var r=n(3914),o=n(4848);function s(){return(0,o.jsxs)("html",{children:[(0,o.jsxs)("head",{children:[(0,o.jsx)("meta",{charSet:"utf-8"}),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,o.jsx)("title",{children:"QR Scanner"}),(0,o.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          body {\n            margin: 0;\n            padding: 0;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n            background: #ffffff;\n            min-height: 100vh;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n          }\n          * {\n            box-sizing: border-box;\n          }\n        "}})]}),(0,o.jsx)("body",{children:(0,o.jsx)("div",{style:{width:"100%",maxWidth:"500px",padding:"20px"},children:(0,o.jsx)(r.A,{})})})]})}}}]);