"use strict";(globalThis.webpackChunkqr_treasurehunt=globalThis.webpackChunkqr_treasurehunt||[]).push([[208],{3914:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(6540),o=n(4848);const a=({huntMode:e,setHuntMode:t,onStartGame:n,treasureCount:r})=>(0,o.jsxs)("div",{style:{marginBottom:20,padding:20,background:"#f8f9fa",borderRadius:8},children:[(0,o.jsx)("h3",{style:{textAlign:"center",marginBottom:15},children:"Choose Hunt Mode"}),(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:15},children:[(0,o.jsxs)("div",{style:{padding:15,border:"sequential"===e?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"sequential"===e?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>t("sequential"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"sequential"===e?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Sequential Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Follow the hunt in order (1, 2, 3...). Perfect for guided tours or specific paths."})]}),(0,o.jsxs)("div",{style:{padding:15,border:"random"===e?"2px solid #007bff":"2px solid #e0e0e0",borderRadius:8,cursor:"pointer",backgroundColor:"random"===e?"#e7f3ff":"#fff",transition:"all 0.2s"},onClick:()=>t("random"),children:[(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:8},children:[(0,o.jsx)("div",{style:{width:16,height:16,borderRadius:"50%",border:"2px solid #007bff",backgroundColor:"random"===e?"#007bff":"transparent",marginRight:10}}),(0,o.jsx)("strong",{children:"Random Hunt"})]}),(0,o.jsx)("p",{style:{margin:0,fontSize:"0.9em",color:"#666"},children:"Find locations in any order. Great for exploration and flexibility."})]})]}),(0,o.jsx)("div",{style:{textAlign:"center",marginTop:20},children:(0,o.jsxs)("button",{onClick:n,style:{padding:"12px 24px",borderRadius:8,border:"none",background:"#007bff",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:"1em",boxShadow:"0 2px 8px rgba(0, 123, 255, 0.3)",transition:"all 0.2s"},onMouseOver:e=>e.target.style.background="#0056b3",onMouseOut:e=>e.target.style.background="#007bff",children:["Start ","sequential"===e?"Sequential":"Random"," Hunt \ud83d\uddfa\ufe0f"]})}),(0,o.jsxs)("div",{style:{textAlign:"center",marginTop:15,fontSize:"0.8em",color:"#666"},children:["Found ",r," locations in database",r>1&&(0,o.jsxs)("span",{children:[" \u2022 ",r-1," QR codes + 1 treasure location"]})]})]}),s=({gameStarted:e,gameComplete:t,scannedCodes:n,treasureSequence:r,huntMode:a,getCurrentSequence:s})=>e?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:10},children:t?`Treasure Hunt Complete! Found ${n.length} locations + treasure`:`Progress: ${n.length} of ${r.length-1} locations found`}),(0,o.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:5},children:s().map((e,r)=>(0,o.jsx)("div",{style:{width:12,height:12,borderRadius:"50%",backgroundColor:r<n.length?"#4caf50":r!==n.length||t?r===s().length-1&&t?"#ffd700":"#e0e0e0":"#2196f3"},title:r===s().length-1?"Treasure location":`Location ${r+1}`},r))}),t&&(0,o.jsx)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:"\ud83c\udfc6 = Treasure location (no QR code here)"}),(0,o.jsxs)("div",{style:{fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)",marginTop:5},children:["Mode: ","sequential"===a?"Sequential":"Random"," Hunt"]})]}):null,i=({currentImage:e,currentStep:t,gameComplete:n,scannedCodes:r,onStartNewHunt:a})=>"NO_DATA"===e?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#fff3cd",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"No Treasure Hunt Data Found"}),(0,o.jsx)("p",{children:"Please use the Treasure Hunt Maker to create some QR codes and images first."}),(0,o.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:"Go to the maker page, scan QR codes, take snapshots, and save them to the database."})]}):"ERROR"===e?(0,o.jsxs)("div",{style:{marginBottom:20,padding:15,background:"#f8d7da",borderRadius:8,textAlign:"center"},children:[(0,o.jsx)("h3",{children:"Error Loading Treasure Hunt"}),(0,o.jsx)("p",{children:"There was an error loading the treasure hunt data."}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#dc3545",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:10},children:"Retry"})]}):e&&0!==e.length?(0,o.jsxs)("div",{style:{marginBottom:20,textAlign:"center"},children:[(0,o.jsx)("h3",{style:{marginBottom:10},children:n?"\ud83c\udf89 Treasure Found! \ud83c\udf89":0===r.length?"Find this location to start!":`Find location ${t}`}),(0,o.jsx)("img",{src:e,alt:`Location ${t}`,style:{maxWidth:"100%",borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"}}),(0,o.jsx)("div",{style:{marginTop:10,fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)"},children:n?"\ud83c\udfc6 This is where the treasure is hidden! No QR code to scan here.":"When you find this location, scan the QR code there to proceed."}),n&&(0,o.jsx)("button",{onClick:a,style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,cursor:"pointer",marginTop:15,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.3)"},children:"Start New Hunt"})]}):(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:"#e3f2fd",borderRadius:8,textAlign:"center"},children:(0,o.jsx)("strong",{children:"Loading treasure hunt..."})});var d=n(6624),l=n.n(d);const c=({onQRCodeScanned:e,width:t=320,height:n=240,style:a={}})=>{const s=(0,r.useRef)(null),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let t,n=null,r=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!r)return void o.getTracks().forEach(e=>e.stop());if(n=o,s.current){s.current.srcObject=o,s.current.setAttribute("playsinline",!0),s.current.setAttribute("muted",!0);const n=async()=>{try{if(await s.current.play(),r&&s.current&&!s.current.paused){const n=()=>{if(r&&s.current&&!s.current.paused){if(s.current&&i.current){const t=i.current.getContext("2d");t.drawImage(s.current,0,0,i.current.width,i.current.height);const n=t.getImageData(0,0,i.current.width,i.current.height),r=l()(n.data,n.width,n.height);r&&r.data&&e(r.data)}r&&(t=setTimeout(()=>{r&&s.current&&!s.current.paused&&n()},200))}};n()}}catch(n){"AbortError"!==n.name&&console.warn("Video play error:",n)}};s.current.readyState>=1?n():s.current.addEventListener("loadedmetadata",n,{once:!0})}}catch(o){console.error("Error accessing camera:",o)}})(),()=>{if(r=!1,t&&clearTimeout(t),s.current&&(s.current.pause(),s.current.srcObject)){s.current.srcObject.getTracks().forEach(e=>e.stop()),s.current.srcObject=null}n&&n.getTracks().forEach(e=>e.stop())}},[e]),(0,o.jsxs)("div",{style:a,children:[(0,o.jsx)("video",{ref:s,style:{width:t,height:n,...a.video}}),(0,o.jsx)("canvas",{ref:i,width:t,height:n,style:{display:"none"}})]})},u=({gameComplete:e,lastScannedCode:t,handleQRCodeScanned:n,scannedCodes:r,currentStep:a,showScannedCode:s,onDismissMessage:i})=>{if(e)return null;const d=t&&(t.includes("Wrong sequence")||t.includes("Already used")||t.includes("Already found")||t.includes("Already scanned")||t.includes("Not part of this hunt")||t.includes("This QR code is part of the treasure hunt but not a location to find"));return(0,o.jsxs)(o.Fragment,{children:[t&&(0,o.jsx)("div",{style:{marginBottom:20,padding:15,background:d?"#ffebee":"#e8f5e8",borderRadius:8,border:d?"1px solid #f44336":"1px solid #4caf50",position:"relative"},children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[(0,o.jsxs)("span",{style:{color:d?"#d32f2f":"#2e7d32",fontWeight:500,flex:1},children:[d?"\u26a0\ufe0f":"\u2705"," ",t.replace(/^Wrong sequence: |^Already used: |^Already scanned: |^Not part of this hunt: /,"")]}),d&&i&&(0,o.jsx)("button",{onClick:i,style:{background:"none",border:"none",color:"#d32f2f",fontSize:"18px",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"30px",height:"30px"},title:"Dismiss message",children:"\u2715"})]})}),(0,o.jsxs)("div",{style:{textAlign:"center"},children:[(0,o.jsx)("h4",{style:{marginBottom:10},children:"QR Code Scanner"}),(0,o.jsx)(c,{onQRCodeScanned:n,width:320,height:240}),s&&t&&!d&&(0,o.jsxs)("div",{style:{marginTop:5,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["Last scanned: ",t]})]})]})};var g=n(4744);const h=({showScannedCode:e=!1})=>{const[t,n]=(0,r.useState)(null),[d,l]=(0,r.useState)(1),[c,h]=(0,r.useState)(null),[f,m]=(0,r.useState)([]),[p,b]=(0,r.useState)([]),[x,y]=(0,r.useState)(!1),[S,R]=(0,r.useState)(""),[C,j]=(0,r.useState)("sequential"),[v,w]=(0,r.useState)(!1),[E,T]=(0,r.useState)([]);(0,r.useEffect)(()=>{(0,g.wU)(n,h,b,(e,t)=>{(0,g.J$)(e,t,h)})},[]);return(0,o.jsxs)("div",{style:{maxWidth:500,margin:"0px auto",padding:20,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,o.jsx)("h2",{style:{textAlign:"center",marginBottom:20},children:"Treasure Hunt"}),!v&&p.length>0&&"NO_DATA"!==c&&"ERROR"!==c&&(0,o.jsx)(a,{huntMode:C,setHuntMode:j,onStartGame:()=>{const e={setGameStarted:w,setCurrentStep:l,setScannedCodes:m,setLastScannedCode:R,setGameComplete:y,setShuffledSequence:T,setCurrentImage:h};(0,g.zj)(C,p,t,e)},treasureCount:p.length}),(0,o.jsx)(s,{gameStarted:v,gameComplete:x,scannedCodes:f,treasureSequence:p,huntMode:C,getCurrentSequence:()=>(0,g.Pr)(C,E,p)}),v&&(0,o.jsx)(i,{currentImage:c,currentStep:d,gameComplete:x,scannedCodes:f,onStartNewHunt:()=>{window.location.reload()}}),v&&(0,o.jsx)(u,{gameComplete:x,lastScannedCode:S,handleQRCodeScanned:e=>{const n={setLastScannedCode:R,setScannedCodes:m,setCurrentStep:l,setGameComplete:y,setCurrentImage:h};(0,g.hP)(e,d,C,E,p,f,t,n)},scannedCodes:f,currentStep:d,showScannedCode:e,onDismissMessage:()=>{R("")}})]})}},4744:(e,t,n)=>{n.d(t,{J$:()=>o,N7:()=>c,Pr:()=>i,UD:()=>r,Wp:()=>s,hP:()=>d,wU:()=>a,xP:()=>u,zj:()=>l});const r=e=>{const t=e.export(),n=function(e){let t,n=0,r=e.length,o="";for(;n<r;)t=e.subarray(n,Math.min(n+32768,r)),o+=String.fromCharCode.apply(null,t),n+=32768;return btoa(o)}(new Uint8Array(t));localStorage.setItem("sqlite-db",n),console.log("Database saved to localStorage")};const o=(e,t,n)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout(()=>{t&&(console.log("Retrying image load with available database"),o(e,t,n))},100),null;try{const r=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode = ?");if(r.bind([e.toString()]),r.step()){const t=r.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),n&&n(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),n&&n(null),null}catch(r){return console.error("Error loading image:",r),n&&n("ERROR"),"ERROR"}},a=async(e,t,n,r)=>{try{console.log("Loading database...");const a={locateFile:()=>"/sql/sql-wasm.wasm"};await(o="/sql/sql-wasm.js",new Promise((e,t)=>{if(window.initSqlJs)return void e();const n=document.createElement("script");n.src=o,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)}));const s=await window.initSqlJs(a),i=localStorage.getItem("sqlite-db");let d;if(i){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(i).split("").map(e=>e.charCodeAt(0)));d=new s.Database(e)}else console.log("No saved database found, creating new one"),d=new s.Database,d.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT);");e(d),((e,t,n,r)=>{try{console.log("Initializing treasure sequence...");const o=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),a=[];for(;o.step();){const e=o.getAsObject();a.push(e.qrkode)}o.free(),console.log("Found treasure sequence:",a),t(a),a.length>0?(console.log("Loading first image for step 1"),r(1,e)):(console.log("No treasures found in database"),n("NO_DATA"))}catch(o){console.error("Error initializing sequence:",o),n("ERROR")}})(d,n,t,r)}catch(a){console.error("Error loading database:",a),t("ERROR")}var o},s=(e,t,n)=>{const r=e.exec("SELECT * FROM steg"),o=r[0]?r[0].values:[];if(t(o),0===o.length)n(1);else{const e=o.map(([e])=>parseInt(e)).filter(e=>!isNaN(e));n(e.length>0?Math.max(...e)+1:1)}},i=(e,t,n)=>"random"===e?t:n,d=(e,t,n,r,a,s,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:g,setGameComplete:h,setCurrentImage:f}=l,m=i(n,r,a),p=m.slice(0,-1),b=p.includes(e),x=s.includes(e);if(b&&!x){u(t=>[...t,e]);const t=p.filter(t=>!s.includes(t)&&t!==e);if(0===t.length){const t=a[a.length-1];o(t,d,f),g(m.length),h(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`)}else{const n=t[0];o(n,d,f),g(s.length+1),1===t.length?c(`${e} found! Find the last location (QR ${n})`):c(`${e} found! Find any of the ${t.length} remaining locations`)}}else x?c(`Already found: QR ${e} was already scanned`):a.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")},l=(e,t,n,r)=>{const{setGameStarted:a,setCurrentStep:s,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=r;if(0!==t.length)if(a(!0),s(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t})(t.slice(0,-1));c([...e,t[t.length-1]]),o(e[0],n,u)}else c(t),o(t[0],n,u)},c=(e,t,n,o,a)=>{try{const i=e.prepare("DELETE FROM steg WHERE qrkode = ?");i.bind([t]),i.step(),i.free(),r(e),s(e,o,a),n(`Item with QR code ${t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),n("Error deleting item from database.")}},u=(e,t,n,o,a,i,d)=>{try{if(t===n||t<0||n<0||t>=o.length||n>=o.length)return;const l=[...o],[c]=l.splice(t,1);l.splice(n,0,c),e.run("DELETE FROM steg"),l.forEach(([t,n])=>{const r=e.prepare("INSERT INTO steg (qrkode, bilde_base64) VALUES (?, ?)");r.bind([t,n]),r.step(),r.free()}),r(e),s(e,i,d);const u=t<n?"down":"up";a(`Moved item with QR code ${c[0]} ${u} to position ${n+1}`)}catch(l){console.error("Error reordering database items:",l),a("Error reordering items in database.")}}},7978:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>g,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"type":"mdx","permalink":"/qr-scanner","source":"@site/src/pages/qr-scanner.mdx","title":"QR Scanner","description":"{`","frontMatter":{"title":"QR Scanner","hide_title":true,"wrapperClassName":"standalone-page"},"unlisted":false}');var o=n(4848),a=n(8453),s=n(3914);const i={title:"QR Scanner",hide_title:!0,wrapperClassName:"standalone-page"},d=void 0,l={},c=[];function u(e){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("style",{children:"\n.standalone-page .navbar {\ndisplay: none !important;\n}\n.standalone-page .footer {\ndisplay: none !important;\n}\n.standalone-page main {\npadding: 0 !important;\nmargin: 0 !important;\n}\nbody.standalone-page {\nbackground: #ffffff;\nmin-height: 100vh;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\n}\n"}),"\n",(0,o.jsx)(s.A,{})]})}function g(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u()}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>i});var r=n(6540);const o={},a=r.createContext(o);function s(e){const t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);