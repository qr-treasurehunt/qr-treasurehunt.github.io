"use strict";(globalThis.webpackChunkqr_treasurehunt=globalThis.webpackChunkqr_treasurehunt||[]).push([[573],{4744:(e,t,r)=>{r.d(t,{J$:()=>o,N7:()=>c,Pr:()=>i,UD:()=>n,Wp:()=>a,hP:()=>d,wU:()=>s,xP:()=>u,zj:()=>l});const n=e=>{const t=e.export(),r=function(e){let t,r=0,n=e.length,o="";for(;r<n;)t=e.subarray(r,Math.min(r+32768,n)),o+=String.fromCharCode.apply(null,t),r+=32768;return btoa(o)}(new Uint8Array(t));localStorage.setItem("sqlite-db",r),console.log("Database saved to localStorage")};const o=(e,t,r)=>{if(console.log(`Loading image for step ${e}`),!t)return console.log("Database not available for loading image"),setTimeout(()=>{t&&(console.log("Retrying image load with available database"),o(e,t,r))},100),null;try{const n=t.prepare("SELECT bilde_base64 FROM steg WHERE qrkode IS ?");if(n.bind([null===e?null:e.toString()]),n.step()){const t=n.getAsObject();return console.log(`Found image for step ${e}:`,t.bilde_base64?"Image data exists":"No image data"),console.log("Image data length:",t.bilde_base64?t.bilde_base64.length:0),console.log("Image data starts with:",t.bilde_base64?t.bilde_base64.substring(0,50):"N/A"),r&&r(t.bilde_base64),t.bilde_base64}return console.log(`No image found for step ${e}`),r&&r(null),null}catch(n){return console.error("Error loading image:",n),r&&r("ERROR"),"ERROR"}},s=async(e,t,r,o)=>{try{console.log("Loading database...");const a={locateFile:()=>"/sql/sql-wasm.wasm"};await(s="/sql/sql-wasm.js",new Promise((e,t)=>{if(window.initSqlJs)return void e();const r=document.createElement("script");r.src=s,r.async=!0,r.onload=e,r.onerror=t,document.body.appendChild(r)}));const i=await window.initSqlJs(a),d=localStorage.getItem("sqlite-db");let l;if(d){console.log("Found saved database in localStorage");const e=new Uint8Array(atob(d).split("").map(e=>e.charCodeAt(0)));l=new i.Database(e)}else console.log("No saved database found, creating new one"),l=new i.Database,l.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT, order_index INTEGER);");e(l),((e,t,r,o)=>{try{console.log("Initializing treasure sequence...");try{e.run("ALTER TABLE steg ADD COLUMN order_index INTEGER"),console.log("Added order_index column to existing table")}catch(s){console.log("order_index column handling:",s.message)}const a=e.prepare("SELECT COUNT(*) as count FROM steg WHERE order_index IS NULL");a.step();const i=a.getAsObject().count;if(a.free(),i>0){console.log("Initializing order_index for existing records");const t=e.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),r=[];for(;t.step();)r.push(t.getAsObject().qrkode);t.free(),r.forEach((t,r)=>{const n=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode = ?");n.bind([r,t]),n.step(),n.free()}),n(e)}const d=e.prepare("SELECT qrkode FROM steg ORDER BY COALESCE(order_index, 999999), CASE WHEN qrkode IS NULL THEN 1 ELSE 0 END"),l=[];for(;d.step();){const e=d.getAsObject();l.push(e.qrkode)}if(d.free(),console.log("Found treasure sequence:",l),t(l),l.length>0){const t=l.find(e=>null!==e);t?(console.log("Loading first image for QR code:",t),o(t,e)):(console.log("No QR codes found, only final treasure"),r("NO_DATA"))}else console.log("No treasures found in database"),r("NO_DATA")}catch(s){console.error("Error initializing sequence:",s),r("ERROR")}})(l,r,t,o)}catch(a){console.error("Error loading database:",a),t("ERROR")}var s},a=(e,t,r)=>{const n=e.exec("SELECT * FROM steg ORDER BY COALESCE(order_index, 999999), CASE WHEN qrkode IS NULL THEN 1 ELSE 0 END"),o=n[0]?n[0].values:[];if(t(o),0===o.length)r(1);else{const e=o.map(([e])=>parseInt(e)).filter(e=>!isNaN(e));r(e.length>0?Math.max(...e)+1:1)}},i=(e,t,r)=>"random"===e?t:r,d=(e,t,r,n,s,a,d,l)=>{const{setLastScannedCode:c,setScannedCodes:u,setCurrentStep:g,setGameComplete:h,setCurrentImage:p}=l,b=i(r,n,s),f=b.filter(e=>null!==e),m=f.includes(e),x=a.includes(e);if("sequential"===r){const a=((e,t,r,n)=>{const o=i(e,t,r);return 0===o.length||n>o.length?null:o[n-1]})(r,n,s,t);if(e===a)if(u(t=>[...t,e]),t===f.length)o(null,d,p),g(b.length),h(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`);else{const r=t+1,n=f[r-1];o(n,d,p),g(r),c(`${e} found! Now find location ${r} (QR ${n})`)}else x?c(`Already found: QR ${e} was already scanned`):m?c(`Out of sequence: You scanned QR ${e}, but please find QR ${a} first (step ${t})`):s.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")}else if(m&&!x){u(t=>[...t,e]);const t=f.filter(t=>!a.includes(t)&&t!==e);if(0===t.length)o(null,d,p),g(b.length),h(!0),c(`${e} found! All locations found! Here's your treasure! \ud83c\udf89`);else{const r=t[0];o(r,d,p),g(a.length+1),1===t.length?c(`${e} found! Find the last location (QR ${r})`):c(`${e} found! Find any of the ${t.length} remaining locations`)}}else x?c(`Already found: QR ${e} was already scanned`):s.includes(e)?c("This QR code is part of the treasure hunt but not a location to find"):c("Not part of this hunt: This QR code doesn't belong to your treasure hunt")},l=(e,t,r,n)=>{const{setGameStarted:s,setCurrentStep:a,setScannedCodes:i,setLastScannedCode:d,setGameComplete:l,setShuffledSequence:c,setCurrentImage:u}=n;if(0!==t.length)if(s(!0),a(1),i([]),d(""),l(!1),"random"===e){const e=(e=>{const t=[...e];for(let r=t.length-1;r>0;r--){const e=Math.floor(Math.random()*(r+1));[t[r],t[e]]=[t[e],t[r]]}return t})(t.filter(e=>null!==e));c([...e,null]),o(e[0],r,u)}else{c(t);const e=t.find(e=>null!==e);e&&o(e,r,u)}},c=(e,t,r,o,s)=>{try{if(null===t){const t=e.prepare("DELETE FROM steg WHERE qrkode IS NULL");t.step(),t.free()}else{const r=e.prepare("DELETE FROM steg WHERE qrkode = ?");r.bind([t]),r.step(),r.free()}const i=e.exec("SELECT qrkode FROM steg ORDER BY COALESCE(order_index, 999999), CASE WHEN qrkode IS NULL THEN 1 ELSE 0 END");i[0]&&i[0].values&&i[0].values.forEach(([t],r)=>{if(null===t){const t=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode IS NULL");t.bind([r]),t.step(),t.free()}else{const n=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode = ?");n.bind([r,t]),n.step(),n.free()}}),n(e),a(e,o,s),r(`Item with QR code ${null===t?"(Final Treasure)":t} has been deleted.`)}catch(i){console.error("Error deleting from database:",i),r("Error deleting item from database.")}},u=(e,t,r,o,s,i,d)=>{try{if(t===r||t<0||r<0||t>=o.length||r>=o.length)return;const l=o[t][0],c=o[r][0];if(null===l||null===c)return void s("Cannot reorder the final treasure location. It must remain last.");const u=[...o],[g]=u.splice(t,1);u.splice(r,0,g),u.forEach(([t],r)=>{if(null===t){const t=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode IS NULL");t.bind([r]),t.step(),t.free()}else{const n=e.prepare("UPDATE steg SET order_index = ? WHERE qrkode = ?");n.bind([r,t]),n.step(),n.free()}}),n(e),a(e,i,d);const h=t<r?"down":"up";s(`Moved item with QR code ${g[0]} ${h} to position ${r+1}`)}catch(l){console.error("Error reordering database items:",l),s("Error reordering items in database.")}}},5292:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>E,contentTitle:()=>x,default:()=>T,frontMatter:()=>m,metadata:()=>n,toc:()=>S});const n=JSON.parse('{"id":"treasurehunter/create-treasure-hunt","title":"Create Treasure Hunt","description":"","source":"@site/docs/treasurehunter/create-treasure-hunt.mdx","sourceDirName":"treasurehunter","slug":"/treasurehunter/create-treasure-hunt","permalink":"/docs/treasurehunter/create-treasure-hunt","draft":false,"unlisted":false,"editUrl":"https://github.com/qr-treasurehunt/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/treasurehunter/create-treasure-hunt.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Create Treasure Hunt","hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"Instructions","permalink":"/docs/treasurehunter/instructions"},"next":{"title":"Perform Treasure Hunt","permalink":"/docs/treasurehunter/treasure-hunt"}}');var o=r(4848),s=r(8453),a=r(6540),i=r(6624),d=r.n(i);const l=(0,a.forwardRef)(({onQRCodeScanned:e,width:t=320,height:r=240,style:n={}},s)=>{const i=(0,a.useRef)(null),l=(0,a.useRef)(null);return(0,a.useImperativeHandle)(s,()=>({takeSnapshot:()=>{if(i.current&&l.current){return l.current.getContext("2d").drawImage(i.current,0,0,l.current.width,l.current.height),l.current.toDataURL("image/jpeg",.8)}return null}})),(0,a.useEffect)(()=>{let t,r=null,n=!0;return(async()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(!n)return void o.getTracks().forEach(e=>e.stop());if(r=o,i.current){i.current.srcObject=o,i.current.setAttribute("playsinline",!0),i.current.setAttribute("muted",!0);const r=async()=>{try{if(await i.current.play(),n&&i.current&&!i.current.paused){const r=()=>{if(n&&i.current&&!i.current.paused){if(i.current&&l.current){const t=l.current.getContext("2d");t.drawImage(i.current,0,0,l.current.width,l.current.height);const r=t.getImageData(0,0,l.current.width,l.current.height),n=d()(r.data,r.width,r.height);n&&n.data&&e&&e(n.data)}n&&(t=setTimeout(()=>{n&&i.current&&!i.current.paused&&r()},200))}};r()}}catch(r){"AbortError"!==r.name&&console.warn("Video play error:",r)}};i.current.readyState>=1?r():i.current.addEventListener("loadedmetadata",r,{once:!0})}}catch(o){console.error("Error accessing camera:",o)}})(),()=>{if(n=!1,t&&clearTimeout(t),i.current&&(i.current.pause(),i.current.srcObject)){i.current.srcObject.getTracks().forEach(e=>e.stop()),i.current.srcObject=null}r&&r.getTracks().forEach(e=>e.stop())}},[e]),(0,o.jsxs)("div",{style:n,children:[(0,o.jsx)("video",{ref:i,style:{width:t,height:r,...n.video}}),(0,o.jsx)("canvas",{ref:l,width:t,height:r,style:{display:"none"}})]})});l.displayName="QRScannerWithSnapshot";const c=l,u=({showScanner:e,setShowScanner:t,qrCode:r,setQrCode:n,setSnapshot:s,setImage:i,setMessage:d})=>{const l=(0,a.useRef)(null);(0,a.useEffect)(()=>{t(!0)},[t]);return(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("label",{style:{display:"block",fontWeight:500,marginBottom:6},children:"QR-code scanner:"}),e&&(0,o.jsxs)("div",{children:[(0,o.jsx)(c,{ref:l,onQRCodeScanned:e=>{n(e),d(`QR code scanned: ${e}`)},width:320,height:240}),(0,o.jsxs)("div",{style:{marginTop:10},children:[(0,o.jsx)("button",{onClick:()=>{if(l.current){const e=l.current.takeSnapshot();e&&(s(e),i(e),d("Snapshot taken! You can now save the QR code and image."))}},style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#4caf50",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",marginRight:8,boxShadow:"0 1px 4px rgba(76, 175, 80, 0.08)",transition:"background 0.2s"},children:"Take Snapshot"}),(0,o.jsx)("button",{onClick:()=>t(!1),style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#757575",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(117, 117, 117, 0.08)",transition:"background 0.2s"},children:"Stop Scanner"})]})]}),!e&&(0,o.jsx)("button",{onClick:()=>t(!0),style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#1976d2",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:"pointer",marginRight:12,boxShadow:"0 1px 4px rgba(25, 118, 210, 0.08)",transition:"background 0.2s"},children:"Start QR Scanner"}),r&&(0,o.jsxs)("div",{style:{marginTop:10,padding:10,background:"#f5f5f5",borderRadius:6},children:[(0,o.jsx)("strong",{children:"Scanned QR Code:"})," ",r]})]})},g=({snapshot:e,setSnapshot:t,image:r,setImage:n,qrCode:s,nextQRNumber:a,handleSave:i,handleSaveFinalTreasure:d})=>(0,o.jsxs)(o.Fragment,{children:[e&&(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("div",{style:{padding:10,background:"#e8f5e8",borderRadius:6,marginBottom:10},children:(0,o.jsx)("strong",{children:"\u2713 Snapshot taken from camera"})}),(0,o.jsx)("button",{onClick:()=>{t(null),n(null)},style:{padding:"8px 16px",borderRadius:6,border:"none",background:"#ff9800",color:"#fff",fontWeight:600,fontSize:"0.9rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(255, 152, 0, 0.08)",transition:"background 0.2s"},children:"Clear Snapshot"})]}),r&&(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("h3",{style:{marginBottom:8},children:"Preview of snapshot:"}),(0,o.jsx)("img",{src:r,alt:"Preview",width:"200",style:{borderRadius:8,boxShadow:"0 1px 6px rgba(0,0,0,0.08)"}})]}),(0,o.jsxs)("div",{style:{marginBottom:24},children:[(0,o.jsxs)("div",{style:{marginBottom:16},children:[(0,o.jsx)("h4",{style:{marginBottom:10},children:"Save Options:"}),(0,o.jsx)("p",{style:{fontSize:"0.9em",color:"var(--ifm-color-emphasis-600)",marginBottom:15},children:"Choose how to save this location:"})]}),(0,o.jsxs)("button",{onClick:i,disabled:!s||!r,style:{padding:"10px 20px",borderRadius:6,border:"none",background:s&&r?"#1976d2":"#ccc",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:s&&r?"pointer":"not-allowed",marginRight:12,marginBottom:8,boxShadow:"0 1px 4px rgba(25, 118, 210, 0.08)",transition:"background 0.2s"},title:s?r?"Save as regular hunt location":"Take a snapshot first":"Scan a QR code first",children:["Save as Hunt Location ",s?`(QR: ${s})`:""]}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{onClick:d,disabled:!r,style:{padding:"10px 20px",borderRadius:6,border:"none",background:r?"#ff9800":"#ccc",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:r?"pointer":"not-allowed",boxShadow:"0 1px 4px rgba(255, 152, 0, 0.08)",transition:"background 0.2s"},title:r?"Save as final treasure location (no QR code needed)":"Take a snapshot first",children:"Save as Final Treasure"}),(0,o.jsxs)("div",{style:{marginTop:10,fontSize:"0.8em",color:"var(--ifm-color-emphasis-600)"},children:["\ud83d\udca1 ",(0,o.jsx)("strong",{children:"Tip:"})," Save hunt locations first (with QR codes), then save the final treasure location last (no QR code)."]})]})]});var h=r(4744);const p=({databaseContent:e,db:t,setDb:r,setMessage:n,setDatabaseContent:s,setQrCode:a,setImage:i,setSnapshot:d,setShowScanner:l,setNextQRNumber:c})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h2",{children:"Image database:"}),(0,o.jsxs)("table",{children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Actions"}),(0,o.jsx)("th",{children:"QR-code"}),(0,o.jsx)("th",{children:"Image (Base64)"}),(0,o.jsx)("th",{children:"Order"})]})}),(0,o.jsx)("tbody",{children:0===e.length?(0,o.jsx)("tr",{children:(0,o.jsx)("td",{colSpan:"4",children:"The database is empty"})}):e.map(([r,a],i)=>{const d=null===r,l=i>0&&!d,u=i<e.length-1&&!d&&null!==e[i+1][0];return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{style:{textAlign:"center"},children:(0,o.jsx)("button",{onClick:()=>(e=>{t?window.confirm(`Are you sure you want to delete the item with QR code ${e}?`)&&(0,h.N7)(t,e,n,s,c):n("Database not available")})(r),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#e74c3c",color:"#fff",fontWeight:600,fontSize:"0.875rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(231, 76, 60, 0.08)",transition:"background 0.2s"},children:"Delete"})}),(0,o.jsx)("td",{children:null===r?"(Final Treasure)":r}),(0,o.jsx)("td",{children:(0,o.jsx)("img",{src:a,alt:`Bilde ${r}`,width:"50"})}),(0,o.jsx)("td",{style:{textAlign:"center",padding:"8px"},children:(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px"},children:[(0,o.jsx)("button",{onClick:()=>(r=>{r>0&&(0,h.xP)(t,r,r-1,e,n,s,c)})(i),disabled:!l,title:d?"Cannot reorder final treasure":l?"Move up":"Already at top",style:{padding:"4px 8px",borderRadius:4,border:"none",background:l?"#3498db":"#bdc3c7",color:"#fff",fontWeight:600,fontSize:"0.75rem",cursor:l?"pointer":"not-allowed",minWidth:"28px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(52, 152, 219, 0.08)",transition:"background 0.2s"},children:"\u2191"}),(0,o.jsx)("button",{onClick:()=>(r=>{r<e.length-1&&(0,h.xP)(t,r,r+1,e,n,s,c)})(i),disabled:!u,title:d?"Cannot reorder final treasure":u?"Move down":"Already at bottom",style:{padding:"4px 8px",borderRadius:4,border:"none",background:u?"#2ecc71":"#bdc3c7",color:"#fff",fontWeight:600,fontSize:"0.75rem",cursor:u?"pointer":"not-allowed",minWidth:"28px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(46, 204, 113, 0.08)",transition:"background 0.2s"},children:"\u2193"})]})})]},i)})})]}),(0,o.jsx)("div",{style:{margin:"24px 0"},children:(0,o.jsx)("button",{onClick:async()=>{localStorage.removeItem("sqlite-db"),n("Databasen er t\xf8mt.");var e;await(e="/sql/sql-wasm.js",new Promise((t,r)=>{if(window.initSqlJs)return void t();const n=document.createElement("script");n.src=e,n.async=!0,n.onload=t,n.onerror=r,document.body.appendChild(n)}));const t=new((await window.initSqlJs({locateFile:()=>"/sql/sql-wasm.wasm"})).Database);t.run("CREATE TABLE IF NOT EXISTS steg (qrkode TEXT PRIMARY KEY, bilde_base64 TEXT, order_index INTEGER);"),r(t),s([]),a(""),i(null),d(null),l(!1),c(1)},style:{padding:"10px 20px",borderRadius:6,border:"none",background:"#e74c3c",color:"#fff",fontWeight:600,fontSize:"1rem",cursor:"pointer",boxShadow:"0 1px 4px rgba(231, 76, 60, 0.08)",transition:"background 0.2s"},children:"Clear database"})})]}),b=({message:e,showScanner:t,setShowScanner:r,qrCode:n,setQrCode:s,setSnapshot:a,setImage:i,setMessage:d,snapshot:l,image:c,nextQRNumber:h,handleSave:b,handleSaveFinalTreasure:f,databaseContent:m,db:x,setDb:E,setDatabaseContent:S,setShowScanner:R,setNextQRNumber:T})=>(0,o.jsxs)("div",{style:{maxWidth:500,padding:24,background:"var(--ifm-background-color)",color:"var(--ifm-font-color-base)",borderRadius:12,boxShadow:"0 2px 16px rgba(0,0,0,0.08)"},children:[(0,o.jsx)("p",{children:e}),(0,o.jsx)(u,{showScanner:t,setShowScanner:r,qrCode:n,setQrCode:s,setSnapshot:a,setImage:i,setMessage:d}),(0,o.jsx)(g,{snapshot:l,setSnapshot:a,image:c,setImage:i,qrCode:n,nextQRNumber:h,handleSave:b,handleSaveFinalTreasure:f}),(0,o.jsx)(p,{databaseContent:m,db:x,setDb:E,setMessage:d,setDatabaseContent:S,setQrCode:s,setImage:i,setSnapshot:a,setShowScanner:R,setNextQRNumber:T})]});const f=()=>{const[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)("Vent, laster inn..."),[s,i]=(0,a.useState)(""),[d,l]=(0,a.useState)(null),[c,u]=(0,a.useState)([]),[g,p]=(0,a.useState)(!1),[f,m]=(0,a.useState)(null),[x,E]=(0,a.useState)(1),S=async()=>{const e={locateFile:()=>"/sql/sql-wasm.wasm"};try{await(r="/sql/sql-wasm.js",new Promise((e,t)=>{if(window.initSqlJs)return void e();const n=document.createElement("script");n.src=r,n.async=!0,n.onload=e,n.onerror=t,document.body.appendChild(n)}));const s=await window.initSqlJs(e);let a;console.log("sql.js initialized \ud83c\udf89");const i=localStorage.getItem("sqlite-db");if(i){const e=new Uint8Array(atob(i).split("").map(e=>e.charCodeAt(0)));a=new s.Database(e),console.log("Database loaded from localStorage");try{a.run("ALTER TABLE steg ADD COLUMN order_index INTEGER"),console.log("Added order_index column to existing table");const e=a.prepare("SELECT qrkode FROM steg ORDER BY CAST(qrkode AS INTEGER)"),t=[];for(;e.step();)t.push(e.getAsObject().qrkode);e.free(),t.forEach((e,t)=>{const r=a.prepare("UPDATE steg SET order_index = ? WHERE qrkode = ?");r.bind([t,e]),r.step(),r.free()}),(0,h.UD)(a)}catch(o){console.log("order_index column handling:",o.message)}}else a=new s.Database,a.run("\n          CREATE TABLE IF NOT EXISTS steg (\n            qrkode TEXT PRIMARY KEY,\n            bilde_base64 TEXT,\n            order_index INTEGER\n          );\n        ");t(a),n("Start scanning QR codes and taking snapshots!"),(0,h.Wp)(a,u,E)}catch(s){console.error("Error initializing sql.js:",s),n("Could not load the database.")}var r};return(0,a.useEffect)(()=>{S()},[]),(0,o.jsx)(b,{message:r,showScanner:g,setShowScanner:p,qrCode:s,setQrCode:i,setSnapshot:m,setImage:l,setMessage:n,snapshot:f,image:d,nextQRNumber:x,handleSave:()=>{if(!s||!d||!e)return void n("Please scan a QR code and take a snapshot first!");const t=e.prepare("SELECT COUNT(*) as count FROM steg WHERE qrkode = ?");t.bind([s]);let r=!1;if(t.step()){r=t.getAsObject().count>0}if(t.free(),r)e.run("UPDATE steg SET bilde_base64 = ? WHERE qrkode = ?",[d,s]),n(`QR-kode ${s} oppdatert med nytt bilde!`);else{const t=e.prepare("SELECT COALESCE(MAX(order_index), -1) as max_order FROM steg WHERE qrkode IS NOT NULL");t.step();const r=t.getAsObject().max_order;t.free(),e.run("INSERT INTO steg (qrkode, bilde_base64, order_index) VALUES (?, ?, ?)",[s,d,r+1]);const o=e.prepare("UPDATE steg SET order_index = order_index + 1 WHERE qrkode IS NULL");o.step(),o.free(),n(`QR-kode ${s} og bilde lagret!`)}(0,h.UD)(e),(0,h.Wp)(e,u,E),i(""),l(null),m(null)},handleSaveFinalTreasure:()=>{if(d&&e)try{const t=e.prepare("SELECT COALESCE(MAX(order_index), -1) as max_order FROM steg");t.step();const r=t.getAsObject().max_order;t.free(),e.run("INSERT INTO steg (qrkode, bilde_base64, order_index) VALUES (?, ?, ?)",[null,d,r+1]),n("Final treasure location saved! This is where the treasure is hidden (no QR code needed)."),(0,h.UD)(e),(0,h.Wp)(e,u,E),m(null),l(null)}catch(t){console.error("Error saving final treasure:",t),n("Error saving final treasure location.")}else n("Please take a snapshot of the treasure location first!")},databaseContent:c,db:e,setDb:t,setDatabaseContent:u,setNextQRNumber:E})},m={sidebar_position:2,title:"Create Treasure Hunt",hide_title:!0},x=void 0,E={},S=[];function R(e){return(0,o.jsx)(f,{})}function T(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(R,{...e})}):R()}},8453:(e,t,r)=>{r.d(t,{R:()=>a,x:()=>i});var n=r(6540);const o={},s=n.createContext(o);function a(e){const t=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);